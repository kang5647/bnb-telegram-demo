const __vite__fileDeps=["assets/index-C-TD4mWi.js","assets/index.browser.esm-BUtsCH6N.js","assets/index-EjQA2ewj.js","assets/index-ZExjcRbi.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{Y as te,R as re,E as le,Q as ie,j as oe,r as m,F as i,w as S,x as G,G as ce,H as l,J as $,L as C,N as me,M as de,o as a,O as ue,h as D,P as k,U as P,V as I,W as ge,_ as F}from"./index-EjQA2ewj.js";import{V as ve,L as pe,n as Ee,S as fe,D as he,T as ye}from"./index-lvHruYIf.js";import{C as _e}from"./chunk-YWXSIORY-BA6est4P.js";import{x as Ne}from"./chunk-CUBEO3NX-DwKZJkOO.js";import{N as we}from"./chunk-DTK23SGK-B0rlBeVX.js";import{u as Te}from"./useTranslation-jD90_ngO.js";import"./colors-CU65dK8u.js";import"./chunk-QDW3HRTT-DDyBM0zq.js";import"./index-DoJjx2bj.js";var Ae="ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",Se={async findAssociatedTokenAddress(y,r){let{TOKEN_PROGRAM_ID:o}=await F(()=>import("./index-C-TD4mWi.js"),__vite__mapDeps([0,1,2,3])),{PublicKey:g}=await F(()=>import("./index.browser.esm-BUtsCH6N.js").then(t=>t.i),__vite__mapDeps([1,2,3]));return g.findProgramAddressSync([new g(y).toBuffer(),o.toBuffer(),new g(r).toBuffer()],new g(Ae))[0]}},V=Se;function Ce(y){let{method:r,param:o,chainId:g}=y,{t}=Te(),_=te(),{setPaymentVerify:q,userInfo:p,setPaymentPassword:K}=re(),{events:z}=le(),{modalOptions:b}=ie(),{authCoreModal:W}=oe(),{errorHandle:H}=_e(),[M,N]=m.useState(!1),O=Ne(),[d,j]=m.useState(),[R,J]=m.useState(),[L,Q]=m.useState(),[Z,E]=m.useState(""),[Y,f]=m.useState(""),{hasSetPaymentPassword:w,showSetPaymentPasswordOrConfirm:X}=ve(),u=m.useMemo(()=>({id:g||i.solana.chainId,name:"Solana"}),[]),ee=m.useMemo(()=>{let n=i.solana.selectedAddress;return S(n)},[]);m.useEffect(()=>{G().catch(n=>{}),ce()&&_("account/master-password/verify")},[_]);let ae=()=>{G().then(()=>{x()}).catch(n=>{var e;N(!1),O.error((e=n.message)!=null?e:"Sign Error")})},B=(n,e)=>{z.emit("signResponse",{result:n,error:e})};async function U(n,e){if(!e)return[];let s=await Promise.all(e.map(n));return e.filter((v,c)=>s[c])}let x=async()=>{var n,e;!r||(k({record_type:P.PAGE_SIGN_CONFIRM_BUTTON_CLICK}),(n=p==null?void 0:p.security_account)!=null&&n.has_set_payment_password?q({visible:!0,onVerifyCompleted:T}):r===l.signAndSendTransaction||r===l.signTransaction||r===l.signAllTransactions||((e=b==null?void 0:b.promptSettingConfig)==null?void 0:e.promptPaymentPasswordSettingWhenSign)===3?X(T):T())},T=async()=>{var n;if(!r)return;N(!0);let e;try{if(r===l.signMessage)e=await i.solana.signMessage(o);else if(r===l.signAndSendTransaction)e=await i.solana.signAndSendTransaction(o,u.id);else if(r===l.signTransaction)e=await i.solana.signTransaction(o,u.id);else if(r===l.signAllTransactions)e=await i.solana.signAllTransactions(o,u.id);else throw new Error("Unknown method");k({record_type:P.PAGE_SIGN_CONFIRM_BUTTON_CLICK_SUCCESS})}catch(s){k({record_type:P.PAGE_SIGN_CONFIRM_BUTTON_CLICK_FAILURE}),(s==null?void 0:s.error_code)===50103&&!((n=p==null?void 0:p.security_account)!=null&&n.has_set_payment_password)?ae():(s==null?void 0:s.message)==="Local Key not found"||(s==null?void 0:s.message)==="Master password decryption error"?_("account/master-password/verify"):H(s)}finally{N(!1)}e&&B(e)};m.useEffect(()=>{if(r===l.signMessage)E(t("sign.signature_message")),f(t("sign.signature_title"));else if(r===l.signAndSendTransaction){E(t("sign.send_transaction")),f(t("sign.approve_and").format($(u)));let n=o.serialize({requireAllSignatures:!1,verifySignatures:!1});h([C.encode(n)])}else if(r===l.signTransaction){E(t("sign.sign_transaction")),f(t("sign.sign_but"));let n=o.serialize({requireAllSignatures:!1,verifySignatures:!1});h([C.encode(n)])}else if(r===l.signAllTransactions){E(t("sign.sign_transaction")),f(t("sign.sign_but"));let n=o.map(e=>C.encode(e.serialize({requireAllSignatures:!1,verifySignatures:!1})));h(n)}else throw new Error("Unknown method")},[o]),m.useEffect(()=>{i.solana.connect()},[]);let h=n=>{i.solana.request({chainId:u.id,method:me.enhancedDeserializeTransaction,params:n}).then(e=>{var s,v;j(e),U(async c=>{let A=await V.findAssociatedTokenAddress(i.solana.selectedAddress,c.mint);return c.associatedTokenAddress===A.toBase58()},(s=e==null?void 0:e.estimatedChanges)==null?void 0:s.nfts).then(c=>{J(c)}),U(async c=>{let A=await V.findAssociatedTokenAddress(i.solana.selectedAddress,c.mint);return c.associatedTokenAddress===A.toBase58()},(v=e==null?void 0:e.estimatedChanges)==null?void 0:v.tokens).then(c=>{Q(c)})}).catch(e=>{var s;de.error({title:(s=e.message)!=null?s:"Deserialize Transaction Error",okCancel:!0,cancelText:t("common.cancel"),okText:t("common.retry"),wrapClassName:"auth-core-modal-error",getContainer:()=>W.rootBody,onOk:()=>{h(n)}})})},ne=()=>{let n=new TextDecoder().decode(o);return a.createElement("div",{className:"sign-message"},a.createElement("div",{className:"message"+(w?"":" no-password-tip")},a.createElement("div",{className:"pre-wrap personal-message"},n)))},se=()=>{var n;return a.createElement(ye,{defaultActiveKey:"1",items:[{label:t("sign.details"),key:"1",children:a.createElement(a.Fragment,null,a.createElement("div",{className:"balance-change"},a.createElement("div",{className:"title"},t("sign.estimated_balance_change")),a.createElement("div",{className:"change-body"},(n=d==null?void 0:d.estimatedChanges)==null?void 0:n.sols.filter(e=>{var s,v;return e.address===((v=(s=i)==null?void 0:s.solana)==null?void 0:v.selectedAddress)}).map((e,s)=>a.createElement("div",{className:"change-title",key:`sol-change-${s}`},"SOL",a.createElement("div",{className:"change-val",style:e.lamportsChange<0?{color:"#ea4335"}:{}},e.lamportsChange<0?"":"+",I(e.lamportsChange,9)))),R==null?void 0:R.map((e,s)=>a.createElement("div",{className:"change-title",key:`nft-change-${s}`},e.name?e.name:"Unknown NFT",a.createElement("div",{className:"change-val",style:e.amountChange<0?{color:"#ea4335"}:{}},e.amountChange<0?"":"+",e.amountChange))),L==null?void 0:L.map((e,s)=>a.createElement("div",{className:"change-title",key:`token-change-${s}`},e.name?e.name:"Unknown Token",a.createElement("div",{className:"change-val",style:e.amountChange<0?{color:"#ea4335"}:{}},e.amountChange<0?"":"+",I(e.amountChange,e.decimals)))))),a.createElement("div",{className:"net-fee solana"},a.createElement("div",{className:"title"},t("sign.network_fee"),d&&a.createElement("div",{className:"fee-val"},I(d.estimatedLamportsFee,9)," SOL"))))},{label:t("sign.data"),key:"2",children:a.createElement("div",null,d==null?void 0:d.instructions.map((e,s)=>a.createElement("div",{className:"inner-instruction",key:`instruction-${s}`},a.createElement("div",{className:"inner-content"},a.createElement("div",{className:"content-item"},a.createElement("div",{className:"item"},a.createElement("div",{className:"item-0"},"#",s+1," - ",t(`program.${e.type}`)),a.createElement("div",{className:"item-1 mt10"},t("sign.program_id"),a.createElement("span",null,S(e.programId))),a.createElement("div",{className:"item-1 mt15"},t("sign.data"),a.createElement("span",null,S(e.data)))))))))}]})};return a.createElement("div",{className:"info-sign"},a.createElement("style",null,pe),!w&&a.createElement("div",{className:"has-payment-password"},a.createElement("div",{className:"has-payment-password-icon"}),a.createElement("div",{className:"has-payment-password-tip"},t("account.waring_tip1")),a.createElement("div",{className:"has-payment-password-set",onClick:K},t("account.set"))),a.createElement("div",{className:"scroll-part"+(w?"":" no-password-tip")},a.createElement(Ee,{userInfo:p,transactionInfo:d}),a.createElement("div",{className:"info-request"},Z),a.createElement("div",{className:"info-title"},a.createElement("img",{src:ue(u),alt:""}),$(u)),a.createElement(fe,{text:i.solana.selectedAddress,onCopy:()=>O.success(t("new.copied_to"))},a.createElement("div",{className:"info-address"},ee,a.createElement("div",{className:"copy-icon"},a.createElement(he,null)))),a.createElement("div",{className:"info-des"},Y),a.createElement("div",{className:"apart-line"}),r===l.signMessage&&ne(),r!==l.signMessage&&se()),a.createElement("div",{className:"btn-box"},a.createElement("div",null,a.createElement(D,{className:"btn-cancel",onClick:()=>{M||B(void 0,ge.userRejectedRequest())}},t("common.cancel")),a.createElement(D,{className:"btn-approve",onClick:x,loading:M},t("common.confirm"))),a.createElement(we,null)))}var Ue=Ce;export{Ue as default};
